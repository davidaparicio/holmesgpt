# Test HealthCheck resources for local testing
---
apiVersion: holmes.robusta.dev/v1alpha1
kind: HealthCheck
metadata:
  name: nginx-health
  namespace: holmes-system
spec:
  query: "Are all pods in deployment 'nginx-test' in namespace 'test-app' healthy and running?"
  schedule: "*/2 * * * *"  # Every 2 minutes
  timeout: 30
  mode: monitor  # Just log, don't alert
  enabled: true
---
apiVersion: holmes.robusta.dev/v1alpha1
kind: HealthCheck
metadata:
  name: broken-app-check
  namespace: holmes-system
spec:
  query: "Are all pods in deployment 'broken-app' in namespace 'test-app' running without crashes?"
  schedule: "*/3 * * * *"  # Every 3 minutes
  timeout: 30
  mode: monitor
  enabled: true
---
apiVersion: holmes.robusta.dev/v1alpha1
kind: HealthCheck
metadata:
  name: memory-check
  namespace: holmes-system
spec:
  query: "Are all pods in namespace 'test-app' using less than 80% of their memory limits?"
  schedule: "*/5 * * * *"  # Every 5 minutes
  timeout: 45
  mode: monitor
  enabled: true
---
apiVersion: holmes.robusta.dev/v1alpha1
kind: HealthCheck
metadata:
  name: node-check
  namespace: holmes-system
spec:
  query: "Are all nodes in the cluster in Ready state?"
  schedule: "*/10 * * * *"  # Every 10 minutes
  timeout: 20
  mode: monitor
  enabled: true
---
# Example of a disabled check
apiVersion: holmes.robusta.dev/v1alpha1
kind: HealthCheck
metadata:
  name: disabled-check
  namespace: holmes-system
spec:
  query: "This check should not run because it's disabled"
  schedule: "* * * * *"  # Would run every minute if enabled
  timeout: 30
  mode: monitor
  enabled: false  # This check is disabled
---
# Check that can be triggered manually
apiVersion: holmes.robusta.dev/v1alpha1
kind: HealthCheck
metadata:
  name: manual-check
  namespace: holmes-system
  annotations:
    description: "Run with: kubectl annotate healthcheck manual-check holmes.robusta.dev/run-now=true"
spec:
  query: "Is the nginx-service in namespace 'test-app' accessible?"
  schedule: "0 0 * * *"  # Daily at midnight (but we'll trigger manually)
  timeout: 15
  mode: monitor
  enabled: true
